
# Google Protocol Buffer
This example is mostly taken from comp4-software repository: 
https://github.com/ParadigmHyperloop/comp4-software/tree/master/Examples/PodTelemetry

We will be using google protocol buffers for structuring and serializing our data so we can transport it quickly over various communication protocols (TCP, UDP, CAN). This folder contains a few examples of using protocol buffers in python. 

The gist is:
* Create a .proto that defines 'messages'
* Compile the .proto file with the protobuf compiler
* This creates classes implementing your defined messages, and also methods to easily interface with these objects
* Instantiate your packet and add your values, serialize, send, and then deserialize on the other end

Official Protobuf Documentation     
`https://developers.google.com/protocol-buffers`


## Setup
* Download and install protocol buffers
* `pip install protobuf` (in your python env)


## Compiling Protobufs
- Edit `Telemetry.proto` file 
- Compile the `.proto` file
    - Run compileme.sh 
    - There should be a `CompileExampleProtos` vscode task button as well if you have the add on by actboy168 installed.
    - DO NOT edit the file resulting from the proto compiler


## Directory Structure
```
├── Telemetry_pb2.pb            # Locally saved compiled protobuf file
├── ParseFromFile.py            # Parse sample Proto packet from file
├── protobufTesting.py          # Sample how to generate Protobuf packet
├── ReceiveFromSocket.py        # Sample file to listen for messages form pod and deserialize them
├── SendToSocket.py             # Sample creating, sending and writing packet
├── resources/              
    ├── Telemetry.proto         # Sample break node proto file
    ├── Telemetry_pb2.py*       # Magic Protobuf file generated from NodeTelem.proto
    ├── compileme.sh            # Bash script to compile any `*.proto` file in the folder, for Python
├── generated/                   
    ├── Telem.txt*               # Contents of proto packet generated by SendToSocket.py
    ├── Telem.pb*                # Serialized proto packet generated by SendToSocket.py, 
                                  used for read/write samples

* = generate file, gitignored
```

## Examples
``` 
ProtobufTesting.py 
```
Demonstrates syntax to create protobuf packet (from comp4 software guys). Prints the size and content of the message before and after being serialized to a bytes-like objects.

```
RecieveFromSocket.py
```
Recieve and parse a proto packet from a UDP socket, print the contents of the packet.

```
SendToSocket.py
```
Create, serialize, and send a proto packet over a UDP socket. Writes the regular and bytes-like objects to their own file in /generated.

```
ParseFromFile.py
```
Parses a packet from a file according to the `.proto` structure, print the parsed message.

```
Telemetry.proto
```
Structure of a .proto file - compile it to get a _pb2.py.



